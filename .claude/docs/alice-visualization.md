# ALICE Visualization System

All visualizations generated by `scripts/gen_all_viz.py`. Code lives in `src/habituation_experiment_alice/viz/`.

## Architecture

```
viz/
    __init__.py          # generate_all_visualizations() + PLOT_REGISTRY
    common.py            # Colors, labels, helpers
    fitness_plots.py     # 5 population-level fitness plots
    agent_trace_plots.py # 5 individual agent behavior plots
    genetics_plots.py    # 3 genotype/network evolution plots
    analysis_plots.py    # 4 cross-run analysis plots
```

## Plot Inventory (18 total)

### Fitness Plots (from `history.npz`)

| Filename | Description |
|----------|-------------|
| `fitness_by_phase.png` | Phase 1 survival fraction + Phase 2 health, per run |
| `fitness_summary.png` | Mean + best fitness with std shading, averaged across runs |
| `fitness_distribution.png` | Histogram of final fitness from `final_fitness.npy` |
| `fitness_std.png` | Fitness standard deviation over generations |
| `survival_rate.png` | Phase 1 survival rate (%) over generations |

### Agent Trace Plots (from `traces/gen_NNNN.npz`)

| Filename | Description |
|----------|-------------|
| `best_agent_trace_phase1.png` | 3-panel trace: environment, signals, health (phase 1) |
| `best_agent_trace_phase2.png` | Same for phase 2 (mixed true/false threats) |
| `discrimination_accuracy.png` | Bar chart: correct response rate per threat type |
| `response_distribution.png` | Overlaid histograms of output by context |
| `health_dynamics_breakdown.png` | Decomposed health: eating vs decay vs damage |

### Genetics Plots (from `history.npz`)

| Filename | Description |
|----------|-------------|
| `genotype_diversity.png` | Mean pairwise Hamming distance over generations |
| `weight_evolution_heatmap.png` | 12-parameter heatmap of best agent across generations |
| `learnable_distribution.png` | Per-parameter learnable fraction evolution |

### Analysis Plots (from `summary.json` + recomputation)

| Filename | Description |
|----------|-------------|
| `run_comparison.png` | Heatmap table comparing final stats across runs |
| `fitness_sensitivity.png` | Single-bit-flip fitness impact (computed at viz time) |
| `connection_ablation.png` | Per-parameter ablation fitness impact (zeroed connections) |
| `ablation_discrimination.png` | Discrimination accuracy for original + each ablated variant |
| `learning_dynamics.png` | Weight values: initial vs after-phase1 vs after-phase2 |

## Data Sources

```
runs/<experiment>/
    config.yaml
    data/
        summary.json              # Aggregate stats, config summary
        run_000/
            history.npz           # Per-generation arrays (13 metrics)
            best_genotype.npy     # Final best genotype
            final_fitness.npy     # Final population fitness
            traces/
                gen_0000.npz      # Checkpoint: full agent trace
                gen_0050.npz
                ...
```

## Adding New Visualizations

1. Add plot function to the appropriate `*_plots.py` module
2. Register in `__init__.py`'s `PLOT_REGISTRY` dict
3. Call it from `generate_all_visualizations()` with the appropriate data

Signature convention: `plot_xxx(data_source, summary, viz_dir, **kwargs) -> Path | None`

## Connection/Parameter Labels

Used in weight heatmaps and learning dynamics plots:
```
Connections: S->O, P->O, O->S, O->P, S->S, P->P, O->O, S->P, P->S
Biases:      B_S, B_P, B_O
```
